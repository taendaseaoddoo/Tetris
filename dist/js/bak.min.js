/*!
 * tetris 1.0.0
 * A Russian tile-matching puzzle video game
 * https://git.oschina.net/dewlyer/Tetris.git
 *
 * Copyright (c) 2017 dewlyer liluak@yeah.net
 *
 * Released under the MIT license
 */
 function drawStar(t,e,o,n,i,l){t.save(),t.translate(o,n),t.rotate(i*Math.PI/180),t.lineWidth=1,t.beginPath();var a=4*Math.PI/5,s=Math.sin(0)*e,c=Math.cos(0)*e;t.moveTo(c,s);for(var r=0;r<5;r++){var h=a*r;s=Math.sin(h)*e,c=Math.cos(h)*e,t.lineTo(c,s)}t.closePath(),t.strokeStyle=l,t.fillStyle=l,t.fill(),t.restore()}function coordinate(t,e,o){var n=50,i=50,l=0,a=0;for(t.beginPath(),t.lineWidth=1,t.strokeStyle="rgba(0,0,0,0.3)";a<o;)a+=i,t.moveTo(l,a),t.lineTo(e,a),t.closePath(),t.stroke();for(a=0;l<e;)l+=n,t.moveTo(l,a),t.lineTo(l,o),t.closePath(),t.stroke()}var canvas=document.getElementById("canvas"),context2D=canvas.getContext("2d");context2D.fillStyle="#01237d",context2D.fillRect(620,420,600,400),context2D.fillStyle="#ffffff",context2D.beginPath(),context2D.moveTo(620,420),context2D.lineTo(670,420),context2D.lineTo(1220,780),context2D.lineTo(1220,820),context2D.lineTo(1170,820),context2D.lineTo(620,460),context2D.closePath(),context2D.fill(),context2D.beginPath(),context2D.moveTo(620,820),context2D.lineTo(620,780),context2D.lineTo(1170,420),context2D.lineTo(1220,420),context2D.lineTo(1220,460),context2D.lineTo(670,820),context2D.closePath(),context2D.fill(),context2D.fillStyle="#d0142d",context2D.beginPath(),context2D.moveTo(620,420),context2D.lineTo(920,615),context2D.lineTo(920,640),context2D.lineTo(620,445),context2D.closePath(),context2D.fill(),context2D.beginPath(),context2D.moveTo(620,820),context2D.lineTo(920,615),context2D.lineTo(920,640),context2D.lineTo(650,820),context2D.closePath(),context2D.fill(),context2D.beginPath(),context2D.moveTo(1220,820),context2D.lineTo(920,620),context2D.lineTo(920,595),context2D.lineTo(1220,795),context2D.closePath(),context2D.fill(),context2D.beginPath(),context2D.moveTo(1220,420),context2D.lineTo(920,620),context2D.lineTo(920,595),context2D.lineTo(1190,420),context2D.closePath(),context2D.fill(),context2D.fillStyle="#ffffff",context2D.fillRect(620,560,600,120),context2D.fillRect(860,420,120,400),context2D.fillStyle="#d0142d",context2D.fillRect(620,580,600,80),context2D.fillRect(880,420,80,400),context2D.save(),context2D.translate(620,10),context2D.fillStyle="rgb(222,40,16)",context2D.fillRect(0,0,600,400),context2D.restore(),context2D.translate(620,10),drawStar(context2D,60,100,100,53.8,"#ffde00"),drawStar(context2D,20,200,40,0,"#ffde00"),drawStar(context2D,20,200,180,0,"#ffde00"),drawStar(context2D,20,240,80,35,"#ffde00"),drawStar(context2D,20,240,140,-19,"#ffde00"),context2D.restore();var flagW=600,flagH=400;context2D.save(),context2D.translate(-610,820),context2D.fillStyle="#ffffff",context2D.fillRect(0,0,flagW,flagH),context2D.fillStyle="#da332a";for(var lineH=flagH/13,i=0;i<=12;i+=2)context2D.fillRect(0,i*lineH,flagW,lineH);context2D.fillStyle="#11257b",context2D.fillRect(0,0,7*lineH*1.3,7*lineH);for(var i=0,j=0;i<30;i++)i%6==0&&j++,drawStar(context2D,.25*lineH,(i%6+.7)*lineH+.54*(i%6)*lineH,(1.48*j-.92)*lineH,54,"#ffffff");for(var i=0,j=0;i<20;i++)i%5==0&&j++,drawStar(context2D,.25*lineH,(i%5+1.5)*lineH+.54*(i%5)*lineH,(1.48*j-.18)*lineH,54,"#ffffff");context2D.restore();var flag_w=600,flag_h=400,radius=.12*flag_h,rb_flag_x=flag_w/2,rb_flag_y=flag_h/2,count_x=3,count_y=2;context2D.save(),context2D.translate(0,820),setInterval(function(){rb_flag_x>flag_w-radius?count_x=-count_x:rb_flag_x<radius&&(count_x=-count_x),rb_flag_y>flag_h-radius?count_y=-count_y:rb_flag_y<radius&&(count_y=-count_y),rb_flag_x+=count_x,rb_flag_y+=count_y,context2D.restore();var t=context2D.createRadialGradient(rb_flag_x,rb_flag_y,radius,rb_flag_x+25,rb_flag_y-15,radius/20);t.addColorStop(0,"#a9270c"),t.addColorStop(.75,"#f03e19"),t.addColorStop(1,"#f25433"),context2D.shadowOffsetX=0,context2D.shadowOffsetY=0,context2D.shadowBlur=0,context2D.shadowColor="#000000",context2D.clearRect(0,0,flag_w,flag_h),context2D.fillStyle="rgb(255,255,255)",context2D.fillRect(0,0,flag_w,flag_h),context2D.shadowOffsetX=-2,context2D.shadowOffsetY=2,context2D.shadowBlur=3,context2D.shadowColor="rgba(0, 0, 0, 0.45)",context2D.fillStyle=t,context2D.beginPath(),context2D.arc(rb_flag_x,rb_flag_y,radius,0,2*Math.PI),context2D.closePath(),context2D.fill(),context2D.save()},8),context2D.save(),context2D.translate(-610,410),context2D.fillStyle="rgb(0,0,0)",context2D.fillRect(0,0,600,400),context2D.fillStyle="#fe0000",context2D.fillRect(0,134,600,134),context2D.fillStyle="#ffcc01",context2D.fillRect(0,266,600,134),function(t,e,o){}(jQuery,window,document),function(t,e,o){"use strict";var n={options:{theme:null,blockWidth:1},_canvas:null,_ctx:null,_$game:null,_$canvas:null,_$gameholder:null,_$start:null,_$score:null,_$scoreText:null,_theme:{},theme:function(e){return"undefined"==typeof e?this.options.theme||this._theme:("string"==typeof e?(this.options.theme=e,this._theme=t.extend(!0,{},tetrisThemes[e])):(this.options.theme=null,this._theme=e),"undefined"!=typeof this._theme&&null!==this._theme||(this._theme=t.extend(!0,{},tetrisThemes.retro),this.options.theme="retro"),void((isNaN(parseInt(this._theme.strokeWidth))||"number"!=typeof parseInt(this._theme.strokeWidth))&&(this._theme.strokeWidth=2)))},_shapes:{line:[[0,-1,0,-2,0,-3,0,-4],[2,-2,1,-2,0,-2,-1,-2],[0,-4,0,-3,0,-2,0,-1],[-1,-2,0,-2,1,-2,2,-2]],square:[[0,0,1,0,0,-1,1,-1],[1,0,1,-1,0,0,0,-1],[1,-1,0,-1,1,0,0,0],[0,-1,0,0,1,-1,1,0]],arrow:[[0,-1,1,-1,2,-1,1,-2],[1,0,1,-1,1,-2,0,-1],[2,-1,1,-1,0,-1,1,0],[1,-2,1,-1,1,0,2,-1]],rightHook:[[2,0,1,0,1,-1,1,-2],[2,-2,2,-1,1,-1,0,-1],[0,-2,1,-2,1,-1,1,0],[0,0,0,-1,1,-1,2,-1]],leftHook:[[0,0,1,0,1,-1,1,-2],[2,0,2,-1,1,-1,0,-1],[2,-2,1,-2,1,-1,1,0],[0,-2,0,-1,1,-1,2,-1]],rightZag:[[1,0,1,-1,0,-1,0,-2],[2,-1,1,-1,1,0,0,0],[0,-2,0,-1,1,-1,1,0],[0,0,1,0,1,-1,2,-1]],leftZag:[[0,0,0,-1,1,-1,1,-2],[2,-1,1,-1,1,-2,0,-2],[1,-2,1,-1,0,-1,0,0],[0,-2,1,-2,1,-1,2,-1]]},_shapeFactory:null,init:function(){var t=this;console.log(t.theme(t.options.theme)),t._create()},updateSiezs:function(){this._PIXEL_WIDTH=this._canvas.width(),this._PIXEL_HEIGHT=this._canvas.height(),this._BLOCK_WIDTH=this.options.blockWidth,this._BLOCK_HEIGHT=Math.floor(this._canvas.height()/this._canvas.width()*this._BLOCK_WIDTH),this._block_size=Math.floor(this._PIXEL_WIDTH/this._BLOCK_WIDTH),this._border_width=2,this._PIXEL_WIDTH=this._block_size*this._BLOCK_WIDTH,this._PIXEL_HEIGHT=this._block_size*this._BLOCK_HEIGHT,this._$canvas.attr("width",this._PIXEL_WIDTH).attr("height",this._PIXEL_HEIGHT)},_create:function(){var t=this;t._createHolder(),t._createUI(),t._createControls()},_setup:function(){var t=this;t._setupShapeFactory(),t._setupFilled(),t._setupInfo(),t._setupBoard(),t.drawBlock()},_createHolder:function(){var e=this;this._$gameholder=t('<div class="tetris-game-holder"></div>'),this._$gameholder.css({position:"relative",width:"100%",height:"100%"}),t(o.body).prepend(this._$gameholder),e._$score=t('<div class="tetris-score-holder"></div>'),e._$gameholder.append(e._$score),e._$start=t('<div class="tetris-start-holder"></div>'),e._$gameholder.append(e._$start)},_createUI:function(){var e=this;e._$canvas=t('<canvas class="tetris-canvas"></canvas>'),e._$canvas.css("background-color",this._theme.background),e._$gameholder.prepend(this._$canvas),e._canvas=this._$canvas.get(0),e._ctx=this._canvas.getContext("2d")},_createControls:function(){console.log("_createControls")},_setupShapeFactory:function(){function e(t,e,o,n){this.x=0,this.y=0,this.symmetrical=o,this.blockType=n,this.blockVariation=null,this.blocksLen=e[0].length,this.orientations=e,this.orientation=0,this.init()}var o=this;null===o._shapeFactory&&(e.prototype.init=function(){this.orientation=0,this.x=Math.floor(o._BLOCK_WIDTH/2)-1,this.y=-1},e.prototype.rotate=function(){var t=(this.orientation+("left"===direction?1:-1)+4)%4;o._checkCollisions(this.x,this.y,this.getBlocks(t))||(this.orientation=t,o._board.renderChanged=!0)},e.prototype.moveRight=function(){o._checkCollisions(this.x+1,this.y,this.getBlocks())||(this.x++,o._board.renderChanged=!0)},e.prototype.moveLeft=function(){o._checkCollisions(this.x-1,this.y,this.getBlocks())||(this.x--,o._board.renderChanged=!0)},e.prototype.drop=function(){o._checkCollisions(this.x,this.y+1,this.getBlocks())||(this.y++,o._board.dropCount=-1,o._board.animate(),o._board.renderChanged=!0)},e.prototype.getBlocks=function(){return this.orientations[void 0!==orientation?orientation:this.orientation]},e.prototype.getBounds=function(){for(var e=t.isArray(_blocks)?_blocks:this.getBlocks(_blocks),o=0,n=e.length,i=999,l=-999,a=999,s=-999;o<n;o+=2)e[o]<i&&(i=e[o]),e[o]>l&&(l=e[o]),e[o+1]<a&&(a=e[o+1]),e[o+1]>s&&(s=e[o+1]);return{left:i,right:l,top:a,bottom:s,width:l-i,height:s-a}},e.prototype.draw=function(){for(var t=this.getBlocks(_orientation),e=void 0===_x?this.x:_x,n=void 0===_y?this.y:_y,i=0,l=0;i<this.blocksLen;i+=2)o._board.drawBlock(e+t[i],n+t[i+1],this.blockType,this.blockVariation,l,this.orientation,!0),l++},this._shapeFactory={line:new e(o,o._shapes.line,(!1),"line"),square:new e(o,o._shapes.square,(!1),"square"),arrow:new e(o,o._shapes.arrow,(!1),"arrow"),leftHook:new e(o,o._shapes.leftHook,(!1),"leftHook"),rightHook:new e(o,o._shapes.rightHook,(!1),"rightHook"),leftZag:new e(o,o._shapes.leftZag,(!1),"leftZag"),rightZag:new e(o,o._shapes.rightZag,(!1),"rightZag")})},_setupFilled:function(){console.log("_setupFilled")},_setupInfo:function(){console.log("_setupInfo")},_setupBoard:function(){console.log("_setupBoard")},_drawBackground:function(){var t=this._theme.strokeWidth;Math.round(.23),Math.round(.3);this._ctx.globalAlpha=1,this._ctx.fillStyle=this._theme.backgroundGrid;for(var e=0;e<this._BLOCK_WIDTH;e++)for(var o=0;o<this._BLOCK_HEIGHT;o++){var n=e*this._block_size,i=o*this._block_size;this._ctx.fillRect(n+t,i+t,this._block_size-2*t,this._block_size-2*t)}this._ctx.globalAlpha=1},drawBlock:function(t,e,o,n,i,l,a){var s=this;t*=s._block_size,e*=s._block_size,a="boolean"==typeof a&&a;var c=(s._theme.strokeWidth,Math.round(.23*s._block_size),Math.round(.3*s._block_size),new Image("../images/block.png")),r={x:0,y:0,w:100,h:100};s._ctx.globalAlpha=1,s._ctx.save(),s._ctx.translate(t,e),s._ctx.translate(s._block_size/2,s._block_size/2),s._ctx.rotate(-Math.PI/2*l),s._ctx.drawImage(c,r.x,r.y,r.w,r.h,-s._block_size/2,-s._block_size/2,s._block_size,s._block_size),s._ctx.restore()},start:function(){this._doStart()},restart:function(){this._doStart()},_doStart:function(){}};t(function(){var t=Object.create(n);t.init()})}(jQuery,window,document);